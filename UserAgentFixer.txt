[Adguard]
!
! Title: "User Agent Fixer" - by K-mik@Z
! Expires: 1 days
! Author: K-mik@Z
! Homepage: https://github.com/K-mikaZ/new_approach_adb__1st/blob/master/UserAgentFixer.txt
! Description: User agent mocker.
!

!#if adguard

!---------------------------------------------------------------------------------------------!
! ... User-Agent reduction snippets
! ...     Code snippets to transform the current Chrome user-agent to the reduced format.
! ...     equivalent to `--enable-features=ReduceUserAgent`
! ...     https://developer.chrome.com/docs/privacy-sandbox/user-agent/snippets/#javascript
! ...     https://www.chromium.org/updates/ua-reduction#TOC-Reduced-User-Agent-String-Reference
! ...     Test here: [reduced-ua.glitch.me](https://reduced-ua.glitch.me/)
! ... READ ALSO
! ...     Prevent covert tracking with User-Agent reduction: https://developer.chrome.com/docs/privacy-sandbox/user-agent/
! ...     Limit passively shared browser data to reduce the volume of sensitive information which leads to fingerprinting.
!
! ...     No current plans for User-Agent Reduction on iOS and Android WebView at this time.
! ...     https://www.chromium.org/updates/ua-reduction/#applicable-platforms
!---------------------------------------------------------------------------------------------!

! reduce UA `only if chromium-based browser` ( test with matched = chromeUAs.exec(navigator.userAgent) )
!+ NOT_PLATFORM(ios)
*#%#(function(){ const chromeUAs = /^Mozilla\/5\.0 \(((?<platform>Lin|Win|Mac|X11; C|X11; L)+[^\)]+)\) AppleWebKit\/537.36 \(KHTML, like Gecko\) Chrome\/(?<major>\d+)[\d\.]+(?<mobile>[ Mobile]*) Safari\/537\.36(.+)?$/; const matched = chromeUAs.exec(navigator.userAgent); if (matched) { const unifiedPlatform = { 'Lin': 'Linux; Android 10; K', 'Win': 'Windows NT 10.0; Win64; x64', 'Mac': 'Macintosh; Intel Mac OS X 10_15_7', 'X11; C': 'X11; CrOS x86_64', 'X11; L': 'X11; Linux x86_64' }; const mockUA = `Mozilla/5.0 (${unifiedPlatform[matched.groups.platform]}) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${matched.groups.major}.0.0.0${matched.groups.mobile} Safari/537.36`; Object.defineProperty(navigator, 'userAgent', { get: function() { return mockUA; } }); }; })();


!---------------------------------------------------------------------------------------------!
! ... Mock the User-Agent ( set to chrome ) for geko-based browser ( replace `Chrome` with `(.+)` in chromeUAs ).
! ... What are the latest user agents for Chrome? https://www.whatismybrowser.com/guides/the-latest-user-agent/chrome
!---------------------------------------------------------------------------------------------!

! #### [FIX] Because of rakuten.tv block linux users, set UA chrome Windows;
!+ NOT_PLATFORM(ios, windows)
rakuten.tv#%#(function(){ const chromeUAs = /^Mozilla\/5\.0 \(((?<platform>Lin|Win|Mac|X11; C|X11; L)+[^\)]+)\) AppleWebKit\/537.36 \(KHTML, like Gecko\) (.+)\/(?<major>\d+)[\d\.]+(?<mobile>[ Mobile]*) Safari\/537\.36(.+)?$/; const matched = chromeUAs.exec(navigator.userAgent); if (matched) { const mockUA = `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${matched.groups.major}.0.0.0${matched.groups.mobile} Safari/537.36`; Object.defineProperty(navigator, 'userAgent', { get: function() { return mockUA; } }); }; })();

! #### [FIX] Youtube speed by setting UA to chrome for gecko-based browser: Google's YouTube load slower in non-Google browsers, specifically Firefox and Edge.
!+ NOT_PLATFORM(ios)
music.youtube.com,m.youtube.com,youtubekids.com,www.youtube.com#%#(function(){ const chromeUAs = /^Mozilla\/5\.0 \(((?<platform>Lin|Win|Mac|X11; C|X11; L)+[^\)]+)\) AppleWebKit\/537.36 \(KHTML, like Gecko\) (.+)\/(?<major>\d+)[\d\.]+(?<mobile>[ Mobile]*) Safari\/537\.36(.+)?$/; const matched = chromeUAs.exec(navigator.userAgent); if (matched) { const unifiedPlatform = { 'Lin': 'Linux; Android 10; K', 'Win': 'Windows NT 10.0; Win64; x64', 'Mac': 'Macintosh; Intel Mac OS X 10_15_7', 'X11; C': 'X11; CrOS x86_64', 'X11; L': 'X11; Linux x86_64' }; const mockUA = `Mozilla/5.0 (${unifiedPlatform[matched.groups.platform]}) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${matched.groups.major}.0.0.0${matched.groups.mobile} Safari/537.36`; Object.defineProperty(navigator, 'userAgent', { get: function() { return mockUA; } }); }; })();

!#endif
